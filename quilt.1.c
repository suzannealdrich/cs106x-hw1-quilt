/* * * File:  quilt.c * Author:  Suzanne Aldrich * Date:  10/3/97 * --------------- * Program that draws a funky fractal sampler quilt. * */#include <stdio.h>#include "genlib.h"#include "extgraph.h"/* Definitions for the entire quilt *///  Number of recursions through DrawQuilt() function; limited by smallest pointsize available.#define MAXRECURSIONLEVEL 1 //  Pre-processor replaces constant "BlockSize" with "scale * 0.75"; //  (other constants don't need to be scaled because they are defined in terms of BlockSize).#define BLOCK_SIZE (scale * 0.75) //  Initial scale factor of BLOCK_SIZE. #define INIT_SCALE 1.5 #define NUM_BLOCKS 5/* Definitions for the "I love C!" block */#define FONT_TO_USE "Helvetica"#define POINT_SIZE (BLOCK_SIZE*72.0)*0.3 /* Definitions for the Bullseye block */#define NUM_CIRCLES 4#define DARK_GRAY .75#define WHITE 0.0#define OUTSIDE_RADIUS (BLOCK_SIZE/2.0)*.8#define INSIDE_RADIUS (BLOCK_SIZE/2.0)*.1/* Definitions for the Log Cabin block */#define NUM_FRAMES 4#define FRAME_WIDTH  BLOCK_SIZE/((NUM_FRAMES*2) +1)#define BOTTOM_DENSITY .75#define LEFT_DENSITY .50#define TOP_DENSITY .25#define RIGHT_DENSITY .15/* Local function declarations *//*  DrawQuilt() is the function which places the quilt blocks in their appropriate positions. *  This is a recursive function; it calls itself with new scale and recursionLevel parameters *  in order to adjust the size of the little quilts. */void DrawQuilt(double xoffset, double yoffset, double scale, int recursionLevel);void DrawBullseye(double x, double y, double scale, double r1, double r2, double circles, string color);void DrawLogCabin(double x, double y, double scale, double frames, string color);void DrawTextBlock(double x, double y, double scale, int rows, int linenumber, string text, string color);void DrawFilledCircle(double r, double density);void DrawFilledBox(double x, double y, double dx, double dy, double density);	void DrawBox(double x, double y, double dx, double dy);double DensitySwitch(int x);/* Implementation */main(){		double xoffset, yoffset, scale = INIT_SCALE;		SetWindowSize(GetFullScreenWidth() * 0.75, GetFullScreenHeight() * 0.75);    InitGraphics();    SetWindowTitle("Please Wait While Your Incredibly Slow Graphics Library Calculates...");        //  Offsets are calculated once; dependant on screensize.    xoffset = (GetWindowWidth() - BLOCK_SIZE * NUM_BLOCKS) / 2;      yoffset = (GetWindowHeight() - BLOCK_SIZE * NUM_BLOCKS) / 2; 	    //  Oth recursion:  draws centered outer quilt with INIT_SCALE.    //  nth recursion:  draws entire quilt inside of custom block with recursion-adjusted scale.    DrawQuilt(xoffset, yoffset, scale, 0);        SetWindowTitle("Aigeanta's Quilt");    printf("Created by Suzanne Aldrich.\n  aigeanta@stanford.edu\n");}void DrawQuilt(double xoffset, double yoffset, double scale, int recursionLevel){    int row, col;	double x, y;		//  Since DrawQuilt() calls itself, it has to test for recursions beyond the limit. 	    if (recursionLevel > MAXRECURSIONLEVEL) return;             for (row = 0; row < NUM_BLOCKS; row++)    {    	y = row * BLOCK_SIZE + yoffset;  //  BLOCK_SIZE is scaled each recursion.    	    	for (col = 0; col < NUM_BLOCKS; col++)    	{	    		x = col * BLOCK_SIZE + xoffset;     		    		//  Block type is dependent on its row/column position in the quilt.    		//  Cycles through block type via mod operator.    		switch ( (row + col) % NUM_BLOCKS) {      		case 0:    			DrawBullseye(x, y, scale, OUTSIDE_RADIUS, INSIDE_RADIUS, NUM_CIRCLES, "Green");     			break;    		case 1:    		    DrawTextBlock(x, y, scale, 3, 1, "I", "Red");   				DrawTextBlock(x, y, scale, 3, 2, "Love", "Red");    			DrawTextBlock(x, y, scale, 3, 3, "C!", "Red");    			break;    		case 2:    		    DrawLogCabin(x, y, scale, NUM_FRAMES, "Magenta");    		    break;    		case 3:    			//  Scrap block reuses other block functions with custom parameters.    		    DrawLogCabin(x, y, scale, 1, "Cyan");			    DrawBullseye(x, y, scale, BLOCK_SIZE / 2 - FRAME_WIDTH * 1.5, 0, 1, "Yellow");			    DrawTextBlock(x, y, scale, 1, 1, "sja", "Black");			    break;    		case 4:    			//  Recursion: quilt scaled down by NUM_BLOCKS to fit in block; calls itself with next recursion level.    			DrawQuilt(x, y, scale / NUM_BLOCKS, recursionLevel + 1);      			break;    		}    		    		//  Outline each block    		SetPenColor("Black");    		DrawBox(x, y, BLOCK_SIZE, BLOCK_SIZE);    		UpdateDisplay();    	}    }}void DrawBullseye(double x, double y, double scale, double r1, double r2, double circles, string color){		int i;	double dx = 0, dy = 0, offset = 0;		offset = BLOCK_SIZE / 2 - r1;  //  	dx = circles > 1 ? (r1 - r2) / (circles - 1) : 0;  //  Sets dx to distance between rings unless circles = 1 (no rings)	dy = BLOCK_SIZE / 2;	SetPenColor(color);	for (i = 0; i < circles; i++)	{			MovePen(x + offset + i * dx, y + dy);		DrawFilledCircle(r1 - i * dx, DensitySwitch(i));  	}}//  Draws shaded circular region and then outlines it.void DrawFilledCircle(double r, double density){			StartFilledRegion(density);	DrawArc(r, -180, 360);	EndFilledRegion();	DrawArc(r, -180, 360);}//  DensitySwitch() uses index from DrawBullseye() to switch between two density options.double DensitySwitch(int x){	return ((x % 2) == 0  ?  DARK_GRAY : WHITE);}void DrawLogCabin(double x, double y, double scale, double frames, string color){	int i;	double FrameLength = 0;		SetPenColor(color);	for (i = 0; i < frames; i++)	{		double offset = i * FRAME_WIDTH;  //  Offset increases at each frame layer.				FrameLength = BLOCK_SIZE - ((2 * (i + 1) - 1) * FRAME_WIDTH);  //  Frameboxes get shorter closer to center of block.				//  Draw each box from each of the four corners of current frame layer.		//  Width and height of box positive or negative depending on corner from which it is drawing.		DrawFilledBox(x + offset, y + offset, FrameLength, FRAME_WIDTH, BOTTOM_DENSITY);		DrawFilledBox(x + offset, y + BLOCK_SIZE - offset, FRAME_WIDTH, -FrameLength, LEFT_DENSITY);		DrawFilledBox(x + BLOCK_SIZE - offset, y + BLOCK_SIZE - offset, -FrameLength, -FRAME_WIDTH, TOP_DENSITY);		DrawFilledBox(x + BLOCK_SIZE - offset, y + offset, -FRAME_WIDTH, FrameLength, RIGHT_DENSITY);	}}//  Draws shaded rectangular region and then outlines it.void DrawFilledBox(double x, double y, double dx, double dy, double density){		StartFilledRegion(density);	DrawBox(x, y, dx, dy);	EndFilledRegion();	DrawBox(x, y, dx, dy);}/*  Draws box from any corner; *  lower left:   + width, + height  (Quadrant 1) *  upper left:   + width, - height  (Quadrant 4) *  upper right:  - width, - height  (Quadrant 3) *  lower right:  - width, + height  (Quadrant 2) *  Arguments are an origin and a vector to the opposite corner. */void DrawBox(double x, double y, double dx, double dy){	MovePen(x, y);	DrawLine(dx, 0);	DrawLine(0, dy);	DrawLine(-dx, 0);	DrawLine(0, -dy);}void DrawTextBlock(double x, double y, double scale, int rows, int linenumber, string text, string color){		double total = 0, start = BLOCK_SIZE / 2;  //  Start at middle of block		SetPenColor(color);	SetFont(FONT_TO_USE);	SetPointSize(POINT_SIZE);	SetStyle(Bold);			//  Number of rows determines where to center each text line.	//  Linenumber determines where to start each text line.	total = rows * GetFontHeight();  		//  Vertically center the top line of the total rows and then move down to the current linenumber. 	start += (total - GetFontHeight() - GetFontAscent()) / 2  -  (linenumber - 1) * GetFontHeight();		MovePen(x + (BLOCK_SIZE - TextStringWidth(text)) / 2, y + start);   //  Moves to draw centered text string.	DrawTextString(text);}/*  Credits: *  -------- *  Thanks to dl@acm.org for recursion implementation advice. */